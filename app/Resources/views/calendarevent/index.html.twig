{% extends 'base.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/fullcalendar/css/fullcalendar/fullcalendar.min.css') }}" />
{% endblock %}

{% block body %}
    <div id="calendar-holder"></div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body">
                    {{ form_start(form) }}
                    {{ form_widget(form) }}
                    <input type="submit" value="Create" />
                    {{ form_end(form) }}
                </div>
                <div class="modal-footer">
                    <button id="modalCloseButton" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block javascripts %}
    <!--<script type="text/javascript" src="{{ asset('assets/fullcalendar/js/fullcalendar/lib/jquery.min.js') }}"></script>-->
    <script type="text/javascript" src="{{ asset('assets/fullcalendar/js/fullcalendar/lib/moment.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/fullcalendar/js/fullcalendar/fullcalendar.min.js') }}"></script>
    <!--<script type="text/javascript" src="{{ asset('assets/fullcalendar/js/fullcalendar/fullcalendar.default-settings.js') }}"></script>-->
    <script type="text/javascript">
        /*$(function () {
            $('#calendar-holder').fullCalendar({
                header: {
                    left: 'prev, next',
                    center: 'title',
                    right: 'month, basicWeek, basicDay,'
                },
                lazyFetching: true,
                timeFormat: {
                    agenda: 'h:mmt',
                    '': 'h:mmt'
                },
                eventStartEditable:{
                    default:true
                },
                eventSources: [
                    {
                        url: '{{ path("load_calendar_event") }}',
                        type: 'POST',
                        data: {},
                        error: function () {}
                    }
                ],
                eventDrop: function (event, dayDelta, minuteDelta, allDay, revertFunc, jsEvent, ui, view) {
                    console.log(event);
                },

                dayClick: function(day) {
                    console.log(day);
                    alert('a day has been clicked!');
                }

            });
        });*/

        $(document).ready(function() {


            $('#calendar-holder').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month, basicWeek, basicDay,agendaWeek,agendaDay'
                },

                navLinks: true, // can click day/week names to navigate views
                selectable: true,
                selectHelper: true,
                select: function(start, end) {

                   /* var title = prompt('Event Title:');
                    var eventData;
                    if (title) {
                        eventData = {
                            title: title,
                            start: start,
                            end: end
                        };
                        console.log(start);
                        console.log(end);
                        $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
                    }
                    $('#calendar').fullCalendar('unselect');*/
                    //$('.modalSubmitButton').show();
                    var modal = $('#myModal').modal('show');
                    var button = $(ev.target);
                    var offset = button.offset();
                    var top = offset.top;
                    modal.css("top",top);

                    var windowWidth = $(window).width();
                    var leftOffset = parseInt(offset.left)-(parseInt(windowWidth)/2);
                    modal.css("left",leftOffset);

                   //ev.preventDefault();
                },
                editable: true,
                eventLimit: true, // allow "more" link when too many events
                eventSources: [
                    {
                        url: '{{ path("load_calendar_event") }}',
                        type: 'POST',
                        data: {},
                        error: function () {}
                    }
                ],
                eventRender: function(event, element) {
                    console.log(element[0].parentNode);
                    /*element.qtip({
                        content: event.description
                    });*/
                    //element.appendChild(event.description);
                    if(event.description)
                    {
                        var divTag = document.createElement("DIV");
                        divTag.appendChild(document.createTextNode(event.description));
                        var newContent = document.createTextNode(event.description);
                        element[0].appendChild(divTag);
                    }

                    var aTag = document.createElement("A");
                    aTag.appendChild(document.createTextNode("Edit"));
                    aTag.href = "{{ path('calendarevent_edit', {'id':-1}) }}".replace("-1", event.id);
                    element[0].appendChild(aTag);

                },

                /*dayRender: function (date,cell) {
                  /!* var td = $(cell);
                   var button = td.add( "button" ).addClass( "btn btn-info btn-circle btn-lg addCalendarEventButton" );
                    button.add("i").addClass("glyphicon glyphicon-plus");*!/
                  var btn = $(cell).append( "<button class='btn btn-info btn-circle btn-xs modalSubmitButton'><i class=\"glyphicon glyphicon-plus\"></i></button>" );
                  btn.hide();
                }*/
            });

        });

        $('#myModal').on('shown.bs.modal', function () {


            // get the viewport height
            var viewportHeight = $(window).height();
            console.log ('viewportHeight = ' + viewportHeight);


            // get the viewport width
            var viewportWidth = $(window).width();
            console.log ('viewportWidth = ' + viewportWidth);

            var modalDialogHeight = $(this).find('.modal-dialog').outerHeight(true);
            console.log ('modalDialogHeight = ' + modalDialogHeight);

            var modalDialogWidth = $(this).find('.modal-dialog').outerWidth(true);
            console.log ('modalDialogWidth = ' + modalDialogWidth);

            var parentHeight = $( window ).height();
            var modal = $('#myModal');
            var top = modal.offset().top;

            console.log('Top offset = ' + top);
            console.log('Parent height = '+ parentHeight);

            if(parseInt(top)+parseInt(modalDialogHeight)>parseInt(parentHeight)) {
                top=parseInt(parentHeight)-parseInt(modalDialogHeight);

                modal.css("top", top);
                console.log("Top offset changed to: "+top);
            }

            //When the browser window is being resized
            var modalContentWidthHeight = function () {

                var modalContentWidth = $('#myModal').find('.modal-content').outerWidth(true);
                console.log ('modalContentWidth = ' + modalContentWidth);

                var modalContentHeight = $('#myModal').find('.modal-content').outerHeight(true);
                console.log ('modalContentHeight = ' + modalContentHeight);
            };

            $(window).resize(modalContentWidthHeight);

        });

        /*$('#myform').on('submit', function(ev) {
            var modal = $('#myModal').modal('show');
            var button = $('#modalSubmitButton');
            var offset = button.offset();
            var top=offset.top;
            modal.css("top", top);

            var parentWidth = $( window ).width();
            var left = parseInt(offset.left)- (parseInt(parentWidth)/2 );
            modal.css("left",left);

            ev.preventDefault()});
*/
        $('.modalSubmitButton').click(function (ev) {
            var modal = $('#myModal').modal('show');
            var button = $(ev.target);
            var offset = button.offset();
            var top = offset.top;
            modal.css("top",top);

            var windowWidth = $(window).width();
            var leftOffset = parseInt(offset.left)-(parseInt(windowWidth)/2);
            modal.css("left",leftOffset);

            ev.preventDefault()
        });

        $('#modalCloseButton').click(function() {
            $('#myModal').modal('hide');
        });
    </script>
{% endblock %}